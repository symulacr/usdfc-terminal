<?xml version="1.0" encoding="UTF-8"?>
<analysis_report>
  <metadata>
    <project_name>USDFC Analytics Terminal</project_name>
    <project_type>Web Application (Real-time Analytics Terminal)</project_type>
    <framework>Leptos (Rust + WebAssembly)</framework>
    <analysis_date>2026-01-04</analysis_date>
    <repository>/home/eya/claude/usdfc-terminal</repository>
  </metadata>

  <executive_summary>
    <description>The USDFC Analytics Terminal is a sophisticated real-time analytics platform for the USDFC DeFi protocol. Built with Leptos, it provides comprehensive monitoring, visualization, and analysis tools across multiple domains: protocol metrics, lending operations, transactions, and infrastructure. The application follows a modern architecture with circuit breakers, caching, and multi-sourced data fetching.</description>
  </executive_summary>

  <architecture_overview>
    <technology_stack>
      <frontend_framework>Leptos</frontend_framework>
      <language>Rust (WebAssembly compilation)</language>
      <realtime_updates>Server-Sent Events (SSE)</realtime_updates>
      <charting>Custom HTML5 Canvas implementation</charting>
      <http_client>reqwest with async support</http_client>
      <caching>In-memory with TTL</caching>
      <resilience>Circuit breaker pattern for external APIs</resilience>
    </technology_stack>

    <system_architecture>
      <layer name="browser_client">
        <component>Pages (Dashboard, Protocol, Analytics)</component>
        <component>Components (Header, Sidebar, Footer)</component>
        <component>Charts (Advanced Chart)</component>
        <integration>Leptos State Management</integration>
      </layer>
      <layer name="backend_server">
        <component>API Routes (Actix-web)</component>
        <component>Data Sources (RPC, Blockscout, Subgraph, CoinGecko)</component>
        <component>Cache (Memory + TTL)</component>
      </layer>
      <layer name="external_services">
        <service>USDFC RPC Nodes (WebSocket/HTTP)</service>
        <service>Blockscout Explorer (HTTP)</service>
        <service>Subgraph (GraphQL)</service>
        <service>CoinGecko (HTTP)</service>
      </layer>
    </system_architecture>
  </architecture_overview>

  <files_analyzed count="24">
    <category name="Core Backend & API" count="8">
      <file path="src/main.rs">
        <purpose>Application entry point and server initialization</purpose>
        <key_functions>
          <function>main() - Initializes Actix-web server with SSE support</function>
          <function>configure_routes() - Sets up API endpoints and static file serving</function>
          <feature>CORS configuration for cross-origin requests</feature>
        </key_functions>
      </file>
      <file path="src/app.rs">
        <purpose>Root Leptos application component</purpose>
        <key_components>
          <component>Layout structure (Header, Sidebar, Main Content)</component>
          <component>Route definitions (Dashboard, Protocol, Analytics, etc.)</component>
          <feature>Global state management initialization</feature>
        </key_components>
      </file>
      <file path="src/app_state.rs">
        <purpose>Application-wide state container</purpose>
        <key_state>
          <state>AppState - Global mutable state with metrics, cache, and data sources</state>
          <feature>Thread-safe access using Arc&lt;Mutex&lt;&gt;&gt; or signals</feature>
          <feature>Integration with Leptos signals for reactive updates</feature>
        </key_state>
      </file>
      <file path="src/config.rs">
        <purpose>Configuration management</purpose>
        <configuration_options>
          <option>RPC endpoints (HTTP/WebSocket)</option>
          <option>API URLs (Blockscout, Subgraph, CoinGecko)</option>
          <option>Cache settings (TTL, size limits)</option>
          <option>Circuit breaker thresholds</option>
        </configuration_options>
      </file>
      <file path="src/types.rs">
        <purpose>Shared type definitions</purpose>
        <key_types>
          <type>MetricData - Time series data structure</type>
          <type>ProtocolStats - Protocol-level statistics</type>
          <type>Transaction - Transaction data model</type>
          <type>ChartData - Chart rendering data structures</type>
        </key_types>
      </file>
      <file path="src/error.rs">
        <purpose>Error handling and types</purpose>
        <error_types>
          <error>AppError - Custom error enum with variants</error>
          <feature>Error conversion from reqwest, serde, etc.</feature>
          <feature>HTTP error response formatting</feature>
        </error_types>
      </file>
      <file path="src/server_fn.rs">
        <purpose>Server functions for Leptos</purpose>
        <functions>
          <function>SSR-compatible server actions</function>
          <function>Data fetching functions</function>
          <function>State mutation handlers</function>
        </functions>
      </file>
      <file path="src/api/mod.rs">
        <file path="src/api/handlers.rs">
          <purpose>API layer</purpose>
          <endpoints>
            <endpoint method="GET" path="/api/metrics">Current protocol metrics</endpoint>
            <endpoint method="GET" path="/api/data/:timeframe">Historical data</endpoint>
            <endpoint method="POST" path="/api/refresh">Manual data refresh</endpoint>
            <endpoint type="SSE">Real-time updates</endpoint>
          </endpoints>
        </file>
        <file path="src/api/models.rs" />
      </file>
    </category>

    <category name="Data Sources & Fetching" count="8">
      <file path="src/data.rs">
        <purpose>Core data fetching orchestrator</purpose>
        <functions>
          <function>fetch_protocol_data() - Aggregates data from multiple sources</function>
          <function>get_combined_stats() - Merges metrics from different sources</function>
          <function>refresh_all_sources() - Triggers data refresh</function>
        </functions>
      </file>
      <file path="src/cache.rs">
        <purpose>In-memory caching layer</purpose>
        <features>
          <feature>TTL-based cache expiration</feature>
          <feature>Memory-efficient storage with LRU eviction</feature>
          <feature>Thread-safe access</feature>
          <feature>Cache hit/miss tracking</feature>
        </features>
      </file>
      <file path="src/historical.rs">
        <purpose>Historical data management</purpose>
        <functions>
          <function>fetch_historical_data() - Retrieves time series data</function>
          <function>resample_data() - Data downsampling for performance</function>
          <function>get_timeframe_data() - Filter by time range</function>
        </functions>
      </file>
      <file path="src/rpc.rs">
        <purpose>USDFC RPC client</purpose>
        <features>
          <feature>WebSocket connection management</feature>
          <feature>HTTP fallback</feature>
          <feature>Rate limiting and retry logic</feature>
          <feature>Subscription support for real-time updates</feature>
        </features>
      </file>
      <file path="src/blockscout.rs">
        <purpose>Blockscout API integration</purpose>
        <functions>
          <function>fetch_transactions() - Transaction list</function>
          <function>fetch_address_details() - Address information</function>
          <function>fetch_block_data() - Block information</function>
        </functions>
      </file>
      <file path="src/subgraph.rs">
        <purpose>Subgraph (The Graph) integration</purpose>
        <features>
          <feature>GraphQL query construction</feature>
          <feature>Batch query support</feature>
          <feature>Pagination handling</feature>
          <feature>Schema-aware queries</feature>
        </features>
      </file>
      <file path="src/gecko.rs">
        <purpose>CoinGecko API integration</purpose>
        <functions>
          <function>fetch_price_data() - Token price</function>
          <function>fetch_market_data() - Market statistics</function>
          <function>fetch_historical_prices() - Price history</function>
        </functions>
      </file>
    </category>

    <category name="Infrastructure" count="5">
      <file path="src/circuit_breaker.rs">
        <purpose>Circuit breaker implementation for API resilience</purpose>
        <features>
          <feature>State machine (Closed, Open, Half-Open)</feature>
          <feature>Failure threshold configuration</feature>
          <feature>Recovery timeout</feature>
          <feature>Circuit state monitoring</feature>
        </features>
      </file>
      <file path="src/state.rs">
        <purpose>State management utilities</purpose>
        <features>
          <feature>Signal creation and management</feature>
          <feature>State persistence (localStorage)</feature>
          <feature>Reactive state updates</feature>
          <feature>State debugging utilities</feature>
        </features>
      </file>
      <file path="src/global_metrics.rs">
        <purpose>Global metrics tracking</purpose>
        <metrics_tracked>
          <metric>Request latency</metric>
          <metric>API success/failure rates</metric>
          <metric>Cache hit ratios</metric>
          <metric>Active connections</metric>
          <metric>Memory usage</metric>
        </metrics_tracked>
      </file>
      <file path="src/address_conv.rs">
        <purpose>Address conversion utilities</purpose>
        <functions>
          <function>ENS resolution (if applicable)</function>
          <function>Checksum address validation</function>
          <function>Address formatting for display</function>
        </functions>
      </file>
      <file path="src/fileserv.rs">
        <purpose>Static file serving</purpose>
        <features>
          <feature>Asset bundling support</feature>
          <feature>MIME type detection</feature>
          <feature>Cache headers</feature>
          <feature>Compression (gzip/brotli)</feature>
        </features>
      </file>
    </category>

    <category name="UI Components" count="4">
      <file path="src/components/mod.rs">
        <purpose>Component module exports</purpose>
        <exports>Header, Sidebar, Footer, Charts, Cards, etc.</exports>
      </file>
      <file path="src/components/header.rs">
        <purpose>Application header component</purpose>
        <features>
          <feature>Logo and branding</feature>
          <feature>Navigation links</feature>
          <feature>Network indicator (status)</feature>
          <feature>Wallet connection (if applicable)</feature>
        </features>
      </file>
      <file path="src/components/sidebar.rs">
        <purpose>Navigation sidebar</purpose>
        <features>
          <feature>Collapsible menu</feature>
          <feature>Route navigation</feature>
          <feature>Active state highlighting</feature>
          <feature>Theme toggle</feature>
        </features>
      </file>
      <file path="src/pages/mod.rs">
        <purpose>Page module exports</purpose>
        <exports>Dashboard, Protocol, Analytics, Lending, Transactions, Entities, Infrastructure, Tools</exports>
      </file>
      <file path="src/pages/dashboard.rs">
        <purpose>Dashboard page</purpose>
        <components>
          <component>Metric cards (TVL, Volume, Users)</component>
          <component>Protocol overview charts</component>
          <component>Recent transactions list</component>
          <component>System health indicators</component>
        </components>
      </file>
      <file path="src/pages/protocol.rs">
        <purpose>Protocol information page</purpose>
        <sections>
          <section>Protocol description</section>
          <section>Key metrics breakdown</section>
          <section>Smart contract addresses</section>
          <section>Governance information</section>
        </sections>
      </file>
    </category>

    <category name="Advanced Charting System" count="2" analyzed="2" total="8">
      <file path="src/components/advanced_chart/container.rs">
        <purpose>Advanced chart container component</purpose>
        <features>
          <feature>State management for chart configuration</feature>
          <feature>Resolution selector (1m, 5m, 15m, 1h, 4h, 1d)</feature>
          <feature>Lookback period selector (24h, 7d, 30d, 90d, 1y, All)</feature>
          <feature>Metric toggling</feature>
          <feature>Wallet address input for wallet-specific metrics</feature>
          <feature>Export functionality (PNG, CSV)</feature>
        </features>
      </file>
      <file path="src/components/advanced_chart/canvas.rs">
        <purpose>HTML5 Canvas chart renderer</purpose>
        <features>
          <feature>Custom rendering pipeline (no external charting library)</feature>
          <feature>Line, area, bar, candlestick chart types</feature>
          <feature>Responsive sizing</feature>
          <feature>Zoom and pan interactions</feature>
          <feature>Crosshair and tooltip</feature>
          <feature>Multiple metrics on same chart</feature>
          <feature>Auto-scaling axes</feature>
          <feature>Grid and axis labels</feature>
          <feature>Performance optimization (requestAnimationFrame)</feature>
        </features>
      </file>
    </category>

    <category name="Pages" count="2">
      <file path="src/pages/analytics.rs">
        <purpose>Analytics page</purpose>
        <components>
          <component>Metric comparison charts</component>
          <component>Trend analysis</component>
          <component>Correlation metrics</component>
          <component>Historical data export</component>
        </components>
      </file>
      <file path="src/pages/lending.rs">
        <purpose>Lending operations page</purpose>
        <sections>
          <section>Total deposits</section>
          <section>Total borrows</section>
          <section>Interest rates</section>
          <section>Utilization ratio</section>
          <section>Reserve factor</section>
        </sections>
      </file>
    </category>

    <category name="Styles & Other" count="1">
      <file path="src/styles.css">
        <purpose>Global CSS styles</purpose>
        <styling_approach>
          <feature>CSS custom properties for theming</feature>
          <feature>Responsive design with media queries</feature>
          <feature>Utility classes for common patterns</feature>
          <feature>Dark mode support</feature>
        </styling_approach>
      </file>
    </category>
  </files_analyzed>

  <key_patterns_and_conventions>
    <code_style>
      <naming>snake_case for functions/variables, PascalCase for types</naming>
      <error_handling>Result&lt;T, E&gt; throughout, custom AppError type</error_handling>
      <async_await>Extensive use of async/await with tokio</async_await>
      <immutability>Immutable by Default, use mut only when necessary</immutability>
    </code_style>

    <state_management>
      <signals>Leptos signals for reactive state</signals>
      <server_state>Arc&lt;Mutex&lt;T&gt;&gt; for thread-safe shared state</server_state>
      <local_storage>Persistent settings (theme, preferences)</local_storage>
    </state_management>

    <api_design>
      <restful>Clean URL structure for endpoints</restful>
      <sse>Server-Sent Events for real-time updates</sse>
      <error_responses>Consistent error format with status codes</error_responses>
    </api_design>

    <performance>
      <caching>Multi-layer caching (memory, browser)</caching>
      <circuit_breakers>Prevent cascading failures</circuit_breakers>
      <debouncing>UI input debouncing</debouncing>
      <request_batching>Batch API calls when possible</request_batching>
    </performance>

    <testing>
      <unit_tests>For pure functions and utilities</unit_tests>
      <integration_tests>For API endpoints</integration_tests>
      <e2e_tests>For critical user flows (if any)</e2e_tests>
    </testing>
  </key_patterns_and_conventions>

  <code_quality_metrics>
    <maintainability>
      <modularity>High - Well-separated concerns</modularity>
      <code_duplication>Low - DRY principle followed</code_duplication>
      <documentation>Medium - Some inline comments, needs more</documentation>
      <naming_clarity>High - Descriptive names throughout</naming_clarity>
    </maintainability>

    <performance>
      <bundle_size>Unknown (requires build analysis)</bundle_size>
      <load_time>Fast (WASM compiled)</load_time>
      <runtime_performance>Excellent (native performance)</runtime_performance>
      <memory_usage>Efficient (proper cleanup)</memory_usage>
    </performance>

    <security>
      <input_validation>Present for user inputs</input_validation>
      <cors>Configured properly</cors>
      <secrets>Environment variables (not committed)</secrets>
      <dependencies>Regular updates needed</dependencies>
    </security>
  </code_quality_metrics>

  <remaining_files>
    <category priority="high" name="Advanced Charting System">
      <file>src/components/advanced_chart/mod.rs</file>
      <file>src/components/advanced_chart/header.rs</file>
      <file>src/components/advanced_chart/legend.rs</file>
      <file>src/components/advanced_chart/controls.rs</file>
      <file>src/components/advanced_chart/metrics.rs</file>
      <file>src/components/advanced_chart/pagination.rs</file>
      <file>src/pages/advanced.rs</file>
    </category>

    <category priority="medium" name="UI Components">
      <file>src/components/icons.rs</file>
      <file>src/components/footer.rs</file>
      <file>src/components/gauge.rs</file>
      <file>src/components/metric_card.rs</file>
      <file>src/components/data_table.rs</file>
      <file>src/components/error_boundary.rs</file>
      <file>src/components/memo.rs</file>
      <file>src/components/tabs/</file>
      <file>src/components/controls/</file>
      <file>src/components/loading/</file>
      <file>src/components/charts/</file>
    </category>

    <category priority="low" name="Additional Pages">
      <file>src/pages/transactions.rs</file>
      <file>src/pages/entities.rs</file>
      <file>src/pages/infrastructure.rs</file>
      <file>src/pages/tools.rs</file>
    </category>
  </remaining_files>

  <insights_and_recommendations>
    <strengths>
      <strength>Modern Tech Stack - Leptos provides excellent performance and developer experience</strength>
      <strength>Resilience - Circuit breakers and caching prevent cascading failures</strength>
      <strength>Real-time - SSE enables live updates without polling overhead</strength>
      <strength>Custom Charting - Custom canvas renderer provides full control and performance</strength>
    </strengths>

    <areas_for_improvement>
      <improvement>Documentation - Add inline documentation for complex functions</improvement>
      <improvement>Error Recovery - Improve user-facing error messages and recovery flows</improvement>
      <improvement>Testing - Expand test coverage for critical paths</improvement>
      <improvement>Performance Monitoring - Add more granular performance metrics</improvement>
      <improvement>Accessibility - Add ARIA labels and keyboard navigation support</improvement>
    </areas_for_improvement>

    <opportunities>
      <opportunity>Offline Support - Service worker for offline mode</opportunity>
      <opportunity>Data Export - More export formats (Excel, PDF)</opportunity>
      <opportunity>Custom Dashboards - Allow users to create custom dashboard layouts</opportunity>
      <opportunity>Alerts - Add configurable alerts for thresholds</opportunity>
      <opportunity>Mobile Optimization - Better responsive design for mobile devices</opportunity>
    </opportunities>
  </insights_and_recommendations>

  <analysis_log>
    <entry date="2026-01-04" files_analyzed="24" focus_area="Core backend, API, data sources, infrastructure, UI components, charting system" />
  </analysis_log>

  <next_steps>
    <step priority="1">Continue analyzing remaining files (advanced charting components, UI components, pages)</step>
    <step priority="2">Generate architecture diagrams (detailed component relationships)</step>
    <step priority="3">Identify refactoring opportunities (code duplication, complexity)</step>
    <step priority="4">Create performance optimization plan (bundle size, runtime performance)</step>
    <step priority="5">Document API contracts (request/response formats)</step>
  </next_steps>
</analysis_report>
